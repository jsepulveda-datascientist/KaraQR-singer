<q-layout view="lHh Lpr lff" class="karaqr-layout">
  <q-header v-if="!isLoginPage" elevated class="layout-header">
    <q-toolbar class="header-toolbar">
      <!-- Botón de menú -->
      <q-btn
        flat
        dense
        round
        icon="menu"
        aria-label="Menu"
        @click="toggleLeftDrawer"
        class="karaqr-btn"
      />

      <!-- Logo y título principal -->
      <q-toolbar-title class="karaqr-logo">
        <q-icon name="mic" class="logo-icon subtle-animation" />
        <span class="logo-text">KaraQR Singer</span>
      </q-toolbar-title>

      <!-- Área de usuario -->
      <div class="row items-center q-gutter-sm">
        <q-btn
          v-if="!user.isAuthenticated"
          flat
          icon="person_add"
          label="Crear perfil"
          @click="redirectToHome"
          class="karaqr-btn"
        />
        
        <div v-else class="row items-center q-gutter-md">
          <div class="user-info-clean text-right">
            <div class="user-name-clean">{{ user.name }}</div>
            <div class="user-role-clean">Cantante</div>
          </div>
          
          <q-btn
            ref="avatarButton"
            flat
            round
            size="md"
            class="avatar-btn-clean"
          >
            <q-avatar size="36px">
              <img v-if="user.avatar" :src="user.avatar" alt="Avatar">
              <q-icon v-else name="person" size="22px" color="white" />
            </q-avatar>
            
            <q-menu
              anchor="bottom right"
              self="top right"
              transition-show="scale"
              transition-hide="scale"
            >
              <q-list style="min-width: 180px">
                <q-item clickable v-close-popup @click="navigateWithTenant('/settings')">
                  <q-item-section avatar>
                    <q-icon name="settings" color="primary" />
                  </q-item-section>
                  <q-item-section>
                    <q-item-label>Configuración</q-item-label>
                  </q-item-section>
                </q-item>
                
                <q-separator />
                
                <q-item clickable v-close-popup @click="logout">
                  <q-item-section avatar>
                    <q-icon name="logout" color="negative" />
                  </q-item-section>
                  <q-item-section>
                    <q-item-label class="text-negative">Cerrar sesión</q-item-label>
                  </q-item-section>
                </q-item>
              </q-list>
            </q-menu>
          </q-btn>
        </div>
      </div>
    </q-toolbar>
  </q-header>

  <q-drawer
    v-if="!isLoginPage"
    v-model="leftDrawerOpen"
    show-if-above
    bordered
  >
    <q-list>
      <q-item-label
        header
      >
        Navegación
      </q-item-label>

      <EssentialLink
        v-for="link in essentialLinks"
        :key="link.title"
        v-bind="link"
      />
    </q-list>
  </q-drawer>

  <q-page-container>
    <router-view />
  </q-page-container>

  <!-- Footer limpio y profesional -->
  <q-footer v-if="!isLoginPage" elevated class="layout-footer">
    <q-toolbar class="footer-toolbar">
      <div class="row items-center justify-between full-width">
        <!-- Logo/Nombre del local -->
        <div class="row items-center q-gutter-xs">
          <q-icon name="store" size="sm" />
          <span class="text-body2">Basement415</span>
        </div>
        
        <!-- Marca central -->
        <div class="text-center">
          <div class="row items-center q-gutter-xs">
            <q-icon name="mic" size="sm" />
            <span class="text-caption">Powered by KaraQR</span>
          </div>
        </div>
        
        <!-- Estado de conexión -->
        <div class="connection-status">
          <q-icon 
            :name="isConnected ? 'wifi' : 'wifi_off'" 
            :class="isConnected ? 'status-icon connected' : 'status-icon disconnected'"
            size="sm"
          />
          <span>{{ isConnected ? 'En línea' : 'Desconectado' }}</span>
        </div>
      </div>
    </q-toolbar>
  </q-footer>
</q-layout>